<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Commande - Vente directe</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <script src="app.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.12.0/dist/cdn.min.js" defer></script>
  
  <style>
    
.img-square {
  width: 100%;
  aspect-ratio: 1 / 1;   /* carr√© parfait */
  object-fit: cover;      /* rogne pour remplir le carr√© */
  //border-radius: 0.5rem;  /* optionnel */
}


.btn-commande {
  background-color: #28a745;
  border: none;
  color: white;
  transition: all 0.2s ease;
  
}
.btn-commande:hover {
  background-color: #218838;
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

.product-card.highlight {
  border: 2px solid #28a745; /* vert Bootstrap pour ‚Äúbio‚Äù */
  box-shadow: 0 0 15px rgba(40, 167, 69, 0.5);
  transform: scale(1.02); /* petit zoom */
  transition: all 0.3s ease;
  background-color: #e6f9ec; /* vert tr√®s p√¢le */
}

.product-card.highlight-warning {
  border: 2px solid #fd7e14; /* orange Bootstrap */
  box-shadow: 0 0 15px rgba(253, 126, 20, 0.5);
  transform: scale(1.02);
  transition: all 0.3s ease;
  background-color: #fff4e6; /* orange tr√®s p√¢le */
}

.product-list-item.highlight {
  border: 2px solid #28a745; /* vert Bootstrap pour ‚Äúbio‚Äù */
  /*box-shadow: 0 0 15px rgba(40, 167, 69, 0.5); */
  transform: scale(1.01); /* petit zoom */
  transition: all 0.3s ease;
  background-color: #e6f9ec; /* vert tr√®s p√¢le */
}

.product-list-item.highlight-warning {
  border: 2px solid #fd7e14; /* orange Bootstrap */
  box-shadow: 0 0 15px rgba(253, 126, 20, 0.5);
  transform: scale(1.02);
  transition: all 0.3s ease;
  background-color: #fff4e6; /* orange tr√®s p√¢le */
}

.spinner-overlay {
  position: fixed;
  top:0; left:0; width:100%; height:100%;
  background-color: #fff; /* fond blanc */
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:1050;
}

.spinner-overlay.hidden { display:none !important; }

.spinner-content { display:flex; flex-direction:column; align-items:center; }

.spinner-container { display:flex; gap:1rem; }

.spinner-dot {
  width: 2rem; height: 2rem; /* plus gros */
  background-color: #28a745;
  border-radius: 50%;
  animation: bounce 1.2s infinite ease-in-out;
}

.spinner-dot2 { animation-delay:0.2s; }
.spinner-dot3 { animation-delay:0.4s; }

@keyframes bounce {
  0%,80%,100% { transform: scale(0); }
  40% { transform: scale(1); }
}

.grayed {
  opacity: 0.4;
  /*pointer-events: none; *//* emp√™che les clics */
}
/* Animation slide-down personnalis√©e */
.notification-toast {
  transform: translateY(-150%);
  opacity: 0;
  transition: transform 0.45s ease-out, opacity 0.45s ease-out;
}

.notification-toast.show {
  transform: translateY(0);
  opacity: 1;
}
</style>
  <style>
    body { padding-top: 90px; padding-bottom: 100px; }
    @media (min-width: 992px) { /* desktop / lg+ */
    body {
        padding-top: 60px; /* ajuster selon la hauteur r√©elle de la navbar sur desktop */
    }
}
    .navbar { box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .footer-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #f8f9fa; border-top: 1px solid #ddd; padding: .5rem 1rem; }
    .product-list-item { border-bottom: 1px solid #ddd; padding: .1rem 0; font-size:0.9em}
    .price { font-weight: 600; color: #198754; }
    .point-retrait { background: #f1f3f5; padding: 1rem; border-radius: .5rem; margin-bottom: 1.5rem; }

    .product-img {
      height: 200px;
      object-fit: cover;
      /*border-radius: 0.5rem 0.5rem 0 0;*/
    }
    
    .alert-small {
  font-size: 12px; /* ou 8px selon ton besoin */
  padding:5px;
}
    
    

@media (max-width: 576px) {
  .product-card {
    display: flex;
    flex-direction: column; /* vertical */
    height: 100%;
  }

  .img-container {
    width: 100%;
    /*height: 150px;*/
    overflow: hidden;
   /* border-radius: 0.5rem;*/
    margin-bottom: 0.5rem;
  }

  .img-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .card-body {
    padding: 0.5rem;
  }
}


    
  </style>
  <style>
    .quantity-selector {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      user-select: none;
    }

    .quantity-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1px solid #ced4da;
      background-color: #f8f9fa;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      font-weight: bold;
      transition: all 0.15s ease;
    }

    .quantity-btn:active {
      transform: scale(0.9);
      background-color: #e9ecef;
    }

    .quantity-input {
      width: 60px;
      text-align: center;
      font-size: 1.2rem;
      border: none;
      border-bottom: 2px solid #ced4da;
      outline: none;
      transition: border-color 0.2s ease;
    }

    .quantity-input:focus {
      border-color: #0d6efd;
    }

    @media (max-width: 400px) {
      .quantity-btn {
        width: 36px;
        height: 36px;
        font-size: 1.2rem;
      }
      .quantity-input {
        width: 50px;
        font-size: 1rem;
      }
    }
  </style>
</head>
<body   x-data="app()" >

<div x-show="loading" id="spinner-overlay" class="spinner-overlay hidden">
  <div class="spinner-content text-center">
    <div class="spinner-container">
      <div class="spinner-dot spinner-dot1"></div>
      <div class="spinner-dot spinner-dot2"></div>
      <div class="spinner-dot spinner-dot3"></div>
    </div>
    <div class="spinner-text mt-3 fw-bold text-dark">
      Chargement de la liste des produits
    </div>
  </div>
</div>

<nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
  <div class="container-fluid d-flex flex-column align-items-start">

    <!-- Ligne titre + switch -->
    <div class="d-flex w-100 align-items-center">
      <h2 class="h5 mb-1 me-3 flex-grow-1">
        <a class="navbar-brand fw-bold" href="#" x-text="pdv.titre || 'Chargement...'"></a>
      </h2>

      <!-- Switch √† droite -->
      <div class="d-flex align-items-center ms-auto">
        <span class="me-2">D√©tails</span>
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" role="switch" id="viewSwitch" x-model="viewList">
          <label class="form-check-label" for="viewSwitch">Liste</label>
        </div>
      </div>
    </div>

    <!-- Ligne date / adresse, toujours sous le titre -->
    <p class="mb-0 small text-muted mt-1 w-100">
      <span x-text="pdv.date ? formatDate(pdv.date) : ''"></span><br class="d-lg-none">
      <span x-text="pdv.adresse || ''"></span>
    </p>

  </div>
</nav>






  

  <main class="container my-4" id="productContainer">

    <template x-if="producteurs.length > 0">
  <template x-for="prod in producteurs" :key="prod.config.prefix">
    <section class="mb-4">
      <div :class="`alert alert-${prod.config.master === 'oui' ? 'primary' : 'info'} alert-small`" role="alert">
        <h4 class="h6 text-uppercase text-muted mb-3"  x-text="`${
      prod.config.master === 'non' ? 'Partenaire : ' + prod.config.nom : prod.config.nom
    }${
      prod.config.master === 'non' && prod.config.exp√©parmaster ? ' (pr√©par√© par Gaylord)' :
      prod.config.master === 'non' && !prod.config.exp√©parmaster ? ' ‚Ä¢ A r√©cup√©rer aupr√®s du partenaire' : ''
    }`"></h4>
        <span x-html="prod.config.texte_court"></span>
      </div>
        <template x-if="prod.hasAlcohol">
          <div class="alert alert-danger" style="font-size:14px;padding:5px">
            L'abus d'alcool est dangereux pour la sant√©, √† consommer avec mod√©ration! Vente interdite aux moins de 18 ans
          </div>
        </template>
        <template x-if="prod.config.master !== 'oui' && prod.config.exp√©parmaster">
  <div 
    class="small mb-3 px-2 py-1 rounded"
    :class="masterTotal < masterMin ? 'bg-danger text-white' : 'bg-success text-white'"
    x-text="masterTotal < masterMin 
            ? `Minimum de commande : ${masterMin}‚Ç¨ chez Les L√©gumes de Gaylord pour d√©bloquer les partenaires pr√©par√©s par Gaylord` 
            : `Commande minimum atteinte (${masterMin}‚Ç¨ √† Les L√©gumes de Gaylord)`">
  </div>
</template>
        <template x-if="prod.config.minCommande > 0 && ((prod.config.master === 'oui' || masterTotal >= masterMin) || prod.config.master !== 'oui')">
  <div 
    class="small mb-3 px-2 py-1 rounded"
    :class="totalPartner(prod) < prod.config.minCommande ? 'bg-warning text-white' : 'bg-success text-white'"
    x-text="
prod.config.master === 'oui'
  ? totalPartner(prod) <prod.config.minCommande
            ? `Minimum de commande : ${prod.config.minCommande}‚Ç¨ necessaire` 
            : `Commande minimum de (${prod.config.minCommande}‚Ç¨ chez ${prod.config.nom} atteinte)`
  : totalPartner(prod) <prod.config.minCommande
            ? `Minimum de commande : ${prod.config.minCommande}‚Ç¨ necessaire si vous commandez` 
            : `Commande minimum du partenaire atteinte (${prod.config.minCommande}‚Ç¨ chez ${prod.config.nom})`" >
  </div>
</template>
         <!-- Mode cartes -->
        <div class="row g-4" x-show="!viewList">
          <template x-if="prod.products.length">
            <template x-for="p in prod.products" :key="p.nom">
              <div class="col-6 col-md-4 col-lg-3" x-data="{ showMessage: false }">
                <div class="card product-card h-100" 
                      :class="{
                       'highlight': p.qty > 0 &&  totalPartner(prod) >= prod.config.minCommande,
                       'highlight-warning': p.qty > 0  && totalPartner(prod) < prod.config.minCommande,
                        'grayed': prod.config.master !== 'oui' && masterTotal < masterMin && prod.config.exp√©parmaster
                      }"
                     @click="
                      if (prod.config.master !== 'oui' && masterTotal < masterMin  && prod.config.exp√©parmaster) {
                        showPartnerToast()
                    }"
                    x-init="initTooltip($el)"
                    :title="p.description">
                    
                    
                  <div class="img-container position-relative">
                    <img :src="p.photo_url || 'https://picsum.photos/500'" class="img-square" :alt="p.nom">
                      <template x-if="p.label === 'AB'">
                    <img src="logo-bio.jpg" class="position-absolute bottom-0 end-0 m-2" style="width:30px;height:30px;" alt="Label AB">
                      </template>
                      <!-- M√©daillon -18 si alcool -->
<template x-if="p.alcool === 'oui'">
  <div class="position-absolute top-0 start-0 m-2
              d-flex align-items-center justify-content-center
              bg-danger text-white rounded-pill px-2 py-1"
       style="font-size:0.75rem; font-weight:bold;">
    interdit -18ans
  </div>
</template>
                  </div>
                  <div class="card-body">
                    <h5 class="card-title" x-text="p.nom"></h5>
    <p class="mb-1 small text-muted"
   x-text="[
     p.categorie ? 'Cat√©gorie: ' + p.categorie : null,
     p.calibre ? 'Calibre: ' + p.calibre : null,
     p.origine ? 'Origine: ' + p.origine : null,
     p.label ? p.label : null,
     p.alcool === 'oui' ? 'interdit -18ans' : null
   ].filter(Boolean).join(' ‚Ä¢ ')">
</p>
<div class="price d-flex flex-column" style="gap:2px;">
  <span x-text="p.prix_unitaire + ' ‚Ç¨ / ' + p.unite"></span>
  <small class="text-muted" style="font-size:0.75rem;" x-text="p.infos_legales"></small>
</div>
                    <div class="quantity-selector">
                      <button class="quantity-btn"@click.stop="
      if (prod.config.master !== 'oui' && masterTotal < masterMin && prod.config.exp√©parmaster) {
        showPartnerToast();
        return;
      }
      p.qty > 0 && checkMasterChange(prod, p, p.qty - 1);
    ">‚àí</button>
                      <input type="number" class="quantity-input" x-model.number="p.qty"  :min="0" :max="p.stock" @click.stop="
      if (prod.config.master !== 'oui' && masterTotal < masterMin && prod.config.exp√©parmaster) {
        showPartnerToast();
        return;
      }
    "
    @change="
      if (prod.config.master !== 'oui' && masterTotal < masterMin && prod.config.exp√©parmaster) {
        showPartnerToast();
        return;
      }
      checkMasterChange(prod, p, p.qty);
    ">
                      <button class="quantity-btn" @click.stop="
      if (prod.config.master !== 'oui' && masterTotal < masterMin && prod.config.exp√©parmaster) {
        showPartnerToast();
        return;
      }
      checkMasterChange(prod, p, p.qty + 1);
    ">+</button>
                    </div>
                  </div>
                </div>
                            
                
              </div>
 
            </template>
          </template>
        </div>
         <!-- Mode liste -->
        <div x-show="viewList">
          <template x-if="prod.products.length">
            <template x-for="p in prod.products" :key="p.nom">
              <div class="product-list-item d-flex justify-content-between align-items-center"
                     :class="{
                       'highlight': p.qty > 0 &&  totalPartner(prod) >= prod.config.minCommande,
                       'highlight-warning': p.qty > 0  && totalPartner(prod) < prod.config.minCommande,
                        'grayed': prod.config.master !== 'oui' && masterTotal < masterMin && prod.config.exp√©parmaster
                      }"
                     @click="
                      if (prod.config.master !== 'oui' && masterTotal < masterMin  && prod.config.exp√©parmaster) {
                        showPartnerToast()
                    }"
                   >
                <div>
                  <strong x-text="p.nom"></strong><br>
               <small x-text="[
    p.categorie ? 'Cat√©gorie: ' + p.categorie : null,
    p.calibre ? 'Calibre: ' + p.calibre : null,
    p.origine ? 'Origine: ' + p.origine : null,
    p.label ? p.label : null,
    p.alcool === 'oui' ? 'interdit -18ans' : null
].filter(Boolean).join(' ‚Ä¢ ')"></small><br/><span class="price" x-text="p.prix_unitaire + ' ‚Ç¨ / ' + p.unite"></span>
                  <small class="text-muted" style="font-size:0.75rem;" x-text="p.infos_legales"></small>
                </div>
                <div class="quantity-selector">
                     <button class="quantity-btn"@click.stop="
      if (prod.config.master !== 'oui' && masterTotal < masterMin  && prod.config.exp√©parmaster) {
        showPartnerToast();
        return;
      }
      p.qty > 0 && checkMasterChange(prod, p, p.qty - 1);
    ">‚àí</button>
                  <input type="number" class="quantity-input" x-model.number="p.qty"  :min="0" :max="p.stock" @click.stop="
      if (prod.config.master !== 'oui' && masterTotal < masterMin  && prod.config.exp√©parmaster) {
        showPartnerToast();
        return;
      }
    "
    @change="
      if (prod.config.master !== 'oui' && masterTotal < masterMin  && prod.config.exp√©parmaster) {
        showPartnerToast();
        return;
      }
      checkMasterChange(prod, p, p.qty);
    ">
                      <button class="quantity-btn" @click.stop="
      if (prod.config.master !== 'oui' && masterTotal < masterMin  && prod.config.exp√©parmaster) {
        showPartnerToast();
        return;
      }
      checkMasterChange(prod, p, p.qty + 1);
    ">+</button>
                </div>
              </div>
            </template>
          </template>
        </div>
    </section>
  </template>
</template>
  </main>
  
<!-- TOAST GLOBAL NOTIFICATION -->
<div class="position-fixed top-0 start-50 translate-middle-x p-3"
     style="z-index: 2000;">
  
  <div id="partnerToast"
       class="toast notification-toast text-bg-info shadow border-0"
       role="alert"
       aria-live="assertive"
       aria-atomic="true">

    <div class="toast-header text-bg-info border-info">
      <i class="bi bi-info-circle-fill me-2"></i>
      <strong class="me-auto">Information</strong>
      <small>Fermer</small>
      <button type="button"
              class="btn-close btn-close-white ms-2 mb-1"
              data-bs-dismiss="toast"
              aria-label="Close"></button>
    </div>

    <div class="toast-body">
      Minimum <strong x-text="masterMin"></strong> ‚Ç¨ chez le producteur principal
      pour pouvoir commander chez les partenaires.
    </div>

  </div>
</div>


<!-- Modal -->
<div class="modal fade" id="alertModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Attention</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
      <!-- BODY -->
        <div class="mb-4">
            <p>Les produits suivants vont √™tre supprim√©s :</p>
            <ul class="list-disc list-inside mt-2">
                <template x-for="p in partnersToRemove" :key="p.nom">
                    <li x-text="p.nom + ' (Qt√©: ' + p.qty + ')'"></li>
                </template>
            </ul>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"  @click="cancelPartnerRemoval" >Annuler</button>
        <button type="button" class="btn btn-primary" @click="confirmPartnerRemoval" >Confirmer</button>
      </div>
    </div>
  </div>
</div>



  <!-- Bandeau bas -->
 <div class="footer-bar d-flex justify-content-between align-items-center bg-white border-top shadow-sm p-3 rounded-3">
    <div class="d-flex flex-column">
        <h5 class="mb-0">
            Total :  
            <span :class="totalClass" class="fw-bold" x-text="total.toFixed(2) + ' ‚Ç¨'"></span>
        </h5>
        <small :class="totalClass" class="mt-1" x-text="totalReason"></small>
    </div>

    <button 
        :class="[
            'btn d-flex align-items-center gap-2 rounded-pill px-4 py-2 text-white', 
            totalClass.replace('text-', 'bg-')
        ]"
         :disabled="totalClass !== 'text-success'"
        data-bs-toggle="offcanvas" data-bs-target="#cartOffcanvas">
        <i class="bi bi-cart-plus-fill"></i> Commander
    </button>
</div>
  
  

  <!-- Offcanvas panier -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="cartOffcanvas">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title">Ma commande</h5>
      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
       <div class="alert alert-warning d-flex justify-content-center align-items-center" role="alert" style="font-size:14px;padding:5px">
      Chaque partenaire est responsable de ses ventes r√©alis√©es directement avec ses clients.
       </div>
      <ul id="cartItems" class="list-group mb-3" style="font-size:0.8em">
      <li class="list-group-item list-group-item-primary">
  <!-- Ligne principale : texte + prix + badge sur la m√™me ligne -->
  <div class="d-flex justify-content-center align-items-center gap-2 mb-1">
    <span>Les L√©gumes de Gaylord</span>
    <span class="text-success fw-bold">8‚Ç¨</span>
    <span class="badge bg-primary">2</span>
  </div>
  
  <!-- Texte en dessous -->
  <small class="text-muted d-block text-center">
    Minimum de commande (10‚Ç¨) non atteint
  </small>
</li>
        <li class="list-group-item d-flex justify-content-between align-items-center list-group-item-secondary" >Botte de carottes *2 <span>4‚Ç¨</span></li>
     <li class="list-group-item list-group-item-warning" style="font-size: 0.9em;">
  <div class="d-flex flex-column align-items-center">
    <!-- Ligne principale : label + input + bouton -->
    <div class="d-flex align-items-center gap-2 w-100 justify-content-center">
      <span>Coupon (code)</span>
      <input type="text" class="form-control w-auto text-center" maxlength="8" placeholder="code">
      <button class="btn btn-success btn-sm ms-1">Valider</button>
    </div>
    <!-- Texte en dessous -->
    <small class="text-muted mt-1 text-center">Les L√©gumes de Gaylord</small>
  </div>
</li>
        <li class="list-group-item list-group-item-info" >
          <div class="d-flex justify-content-center align-items-center gap-2 mb-1">
    <span>Les Herbes libres</span>
    <span class="text-success fw-bold">6‚Ç¨</span>
    <span class="badge bg-primary">1</span>
  </div>
  
  <!-- Texte en dessous -->
  <small class="text-muted d-block text-center">
    Pr√©par√© par Gaylord
  </small>
</li>
          
        </li>
         <li class="list-group-item d-flex justify-content-between align-items-center list-group-item-secondary" >Botte de carottes *2 <span>4‚Ç¨</span></li>
          <li class="list-group-item d-flex justify-content-between align-items-center list-group-item-secondary" >Botte de carottes *2 <span>4‚Ç¨</span></li>
       <li class="list-group-item list-group-item-info" >
          <div class="d-flex justify-content-center align-items-center gap-2 mb-1">
    <span>Trip-Hop</span>
    <span class="text-success fw-bold">6‚Ç¨</span>
    <span class="badge bg-primary">1</span>
  </div>
  
  <!-- Texte en dessous -->
  <small class="text-muted d-block text-center">
    A retirer aupr√®s du vendeur
  </small>
</li>
         <li class="list-group-item d-flex justify-content-between align-items-center list-group-item-secondary" >Botte de carottes *2 <span>4‚Ç¨</span></li>
          <li class="list-group-item d-flex justify-content-between align-items-center list-group-item-secondary" >Botte de carottes *2 <span>4‚Ç¨</span></li>
        <li class="list-group-item list-group-item-danger" style="font-size: 0.9em;">
  <div class="d-flex flex-column align-items-center">
    <!-- Ligne principale : label + input + bouton -->
    <div class="d-flex align-items-center gap-2 w-100 justify-content-center">
      <span>Achat d'alcool</span>
       <input class="form-check-input" type="checkbox" value="" id="checkDefault">
  <label class="form-check-label" for="checkDefault">
    Je certifie avoir + de 18 ans
  </label>
    </div>
     <small class="text-muted mt-1 text-center">L'abus d'alcool est dangereux pour la sant√©, √† consommer avec mod√©rations.</small>
  </div>
</li>
      </ul>
      <p class="fw-bold">Total : <span id="cartTotal" class="text-success fw-bold">0,00 ‚Ç¨</span></p>
      <div class="mb-3">
       <form class="p-3 border rounded shadow-sm needs-validation" novalidate>
  <!-- Ligne 1 : Nom et Pr√©nom -->
  <div class="row mb-3">
    <div class="col-md-6 mb-3 mb-md-0">
      <label for="nom" class="form-label">Nom *</label>
      <input type="text" class="form-control" id="nom" placeholder="Votre nom" required>
      <div class="invalid-feedback">
        Veuillez saisir votre nom.
      </div>
    </div>
    <div class="col-md-6">
      <label for="prenom" class="form-label">Pr√©nom *</label>
      <input type="text" class="form-control" id="prenom" placeholder="Votre pr√©nom" required>
      <div class="invalid-feedback">
        Veuillez saisir votre pr√©nom.
      </div>
    </div>
  </div>

  <!-- Ligne 2 : Email -->
  <div class="mb-3">
    <label for="email" class="form-label">Email *</label>
    <input type="email" class="form-control" id="email" placeholder="exemple@mail.com" required>
    <div class="invalid-feedback">
      Veuillez saisir une adresse email valide.
    </div>
  </div>

  <!-- Ligne 3 : T√©l√©phone -->
  <div class="mb-3">
    <label for="telephone" class="form-label">T√©l√©phone *</label>
    <input type="tel" class="form-control" id="telephone" placeholder="06 12 34 56 78" required pattern="[0-9\s\-]{10,}">
    <div class="invalid-feedback">
      Veuillez saisir un num√©ro de t√©l√©phone valide.
    </div>
  </div>
      </div>
      <p class="fw-bold">Notifications</p>
     <div class="form-check form-switch" >
  <input class="form-check-input" type="checkbox" role="switch" id="switchCheckDefault">
  <label class="form-check-label" for="switchCheckDefault" style="font-size:0.8em">Etre averti de l'ouverture des ventes chaque semaine</label>
     </div>
  <div class="form-check form-switch">
  <input class="form-check-input" type="checkbox" role="switch" id="switchCheckDefault">
  <label class="form-check-label" for="switchCheckDefault"  style="font-size:0.8em">Recevoir les offres promotionnelles et les reductions fid√©lit√©</label>
  </div>
  <div class="form-check form-switch">
  <input class="form-check-input" type="checkbox" role="switch" id="switchCheckDefault">
  <label class="form-check-label" for="switchCheckDefault"   style="font-size:0.8em">Recevoir les messages d'informations, cong√©s, nouveaux partenaires etc...</label>

</div>

      <button class="btn btn-danger w-100 mt-3" onclick="checkout()">Minimum de commande non atteint</button>
  <small class="text-muted d-block text-center">
    Verifiez votre commande
  </small>
    </div>
  </div>
  
<div id="toast-container" class="position-fixed bottom-0 end-0 p-3" style="z-index: 1080;"></div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>


    // Panier simple
    let cart = [];
    let panier = {}; // Structure: { nomProduit: {prix, quantite, total} }
    function addToCart(name, price) {
      cart.push({name, price});
      updateCartUI();
    }
    function updateCartUI() {
      const list = document.getElementById('cartItems');
      list.innerHTML = '';
      let total = 0;
    Object.entries(panier).forEach(([nomProduit, item]) => {
  total += parseFloat(item.total);
  const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.textContent = nomProduit+' *'+item.quantite;
       const span = document.createElement('span');
        span.textContent = item.total + ' ‚Ç¨';
        li.appendChild(span);
        list.appendChild(li);
});
        
      
      document.getElementById('cartTotal').textContent = total.toFixed(2) + ' ‚Ç¨';
      document.getElementById('cartSummary').textContent = `${total.toFixed(2)} ‚Ç¨`;
    }
    function checkout() {
      alert('Commande envoy√©e !');
      cart = [];
      updateCartUI();
    }

 
function updatePartnerInputs() {
  const masterSection = document.querySelector('section[data-master="true"]');
  if (!masterSection) return;

  const minPartenaire = parseFloat(masterSection.dataset.minpartenaire);

  // Calcul du total ‚Ç¨ du master !! ON PREND AUSSI LE MODE LISTE...
  let totalMaster = 0;
  masterSection.querySelectorAll('.card-body .quantity-input').forEach(input => {
    const prix = parseFloat(input.dataset.price || 0);
    totalMaster += (parseInt(input.value, 10) || 0) * prix;
  });
  console.log("TotalMaster:"+totalMaster);


  // D√©sactiver/activer les inputs + boutons des non-master
  const allSections = document.querySelectorAll('section.mb-4');
  const nonMasterSections = Array.from(allSections).filter(sec => sec.dataset.master !== "true");
let resetProducts = new Set();
  nonMasterSections.forEach(sec => {
    sec.querySelectorAll('.quantity-input, .quantity-btn').forEach(el => {

     const disable = totalMaster < minPartenaire;
     el.disabled = disable;
     
      // On d√©truit toujours l'ancien tooltip pour √©viter les doublons
    if (el._tooltip) {
      el._tooltip.dispose();
      el._tooltip = null;
    }
     
     
        if (disable) {
      // Ajouter le titre
      el.setAttribute('title', `Le minimum master n'est pas atteint (${minPartenaire}‚Ç¨ requis)`);
      // Cr√©er un nouveau tooltip
      el._tooltip = new bootstrap.Tooltip(el, {
        placement: 'top',
        trigger: 'hover focus'
      });
    } else {
      // Supprimer le title si actif
      el.removeAttribute('title');
    }

     // Si on d√©sactive, on remet l'input √† 0
    if (disable && el.classList.contains('quantity-input')  && parseInt(el.value, 10) > 0) {
      //Il faut dire attention on va mettre a 0!!
       const prodName = el.closest('.quantity-selector').dataset.product;
         resetProducts.add(prodName);  // Set emp√™che les doublons
       
      el.value = 0;
      updateQuantity(el, 0);
    }
  });
});
  if (resetProducts.size > 0) {
  showToast(`Les produits suivants ont √©t√© supprim√©s du panier car le minimum master n'est pas atteint : ${Array.from(resetProducts).join(', ')}`);
}
}

  function updateCart(product, price, quantity) {
    if (quantity <= 0) {
      delete panier[product];
    } else {
      panier[product] = {
        prix_unitaire: price,
        quantite: quantity,
        total: (price * quantity).toFixed(2)
      };
    }
    console.log("üõí Panier mis √† jour :", panier);
    // üëâ Ici, tu peux mettre √† jour une ic√¥ne ou un compteur si tu veux
    
     updateCartUI();
  }

/*
function showToast(message, title = 'Attention') {
  const container = document.getElementById('toast-container');
  if (!container) return;

  // Cr√©e le toast
  const toastEl = document.createElement('div');
  toastEl.className = 'toast align-items-center text-bg-warning border-0';
  toastEl.setAttribute('role', 'alert');
  toastEl.setAttribute('aria-live', 'assertive');
  toastEl.setAttribute('aria-atomic', 'true');

  toastEl.innerHTML = `
    <div class="toast-header"><strong class="me-auto"> ${title}</strong>
    <small>Produits partenaires supprim√©s</small>
    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
  </div>
      <div class="toast-body">
        ${message}
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  `;

  container.appendChild(toastEl);

  // Initialise le toast
  const toast = new bootstrap.Toast(toastEl, { delay: 5000 });
  toast.show();

  // Supprime le toast du DOM apr√®s disparition
  toastEl.addEventListener('hidden.bs.toast', () => toastEl.remove());
}
*/


function initTooltip(el) {
  const tooltip = new bootstrap.Tooltip(el, {
    trigger: 'manual', // on contr√¥le l'ouverture
    placement: 'top',
    html: true
  });

  el.addEventListener('mouseenter', () => tooltip.show());
  el.addEventListener('mouseleave', () => tooltip.hide());
  
  el.addEventListener('click', (e) => {
    tooltip.show();
    document.addEventListener('click', function onDocClick(event) {
      if (!el.contains(event.target)) {
        tooltip.hide();
        document.removeEventListener('click', onDocClick);
      }
    });
  });
}


</script>

</body>
</html>
